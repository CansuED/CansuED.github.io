{% include base_path %}

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="site-title">
      <a href="{{ base_path }}/lab/">D^4 Sustainable Futures</a>
    </div>
    
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <input type="checkbox" id="nav-toggle" class="nav-toggle">
        
        <label for="nav-toggle" class="nav-toggle-label">
          <span>‚ò∞</span>
        </label>
        
        <ul class="visible-links">
          {% for link in site.data.navigation.lab %}
            {% if link.url contains 'http' %}
              {% assign domain = '' %}
            {% else %}
              {% assign domain = base_path %}
            {% endif %}
            
            {% assign current_class = '' %}
            {% if page.url == link.url %}
              {% assign current_class = 'masthead__menu-item--active' %}
            {% elsif page.url contains link.url and link.url != '/' and link.url != '/lab/' %}
              {% assign current_class = 'masthead__menu-item--active' %}
            {% else %}
              {% assign current_class = 'masthead__menu-item' %}
            {% endif %}
            
            <li class="{{ current_class }}">
              <a href="{{ domain }}{{ link.url }}">{{ link.title }}</a>
            </li>
          {% endfor %}
        </ul>
      </nav>
    </div>
  </div>
</div>

<script>
(function() {
  const mastheadMenu = document.querySelector('.masthead__menu');
  const currentTheme = localStorage.getItem('theme') || 'light';
  
  if (mastheadMenu) {
    const themeToggle = document.createElement('button');
    themeToggle.className = 'theme-toggle';
    themeToggle.setAttribute('aria-label', 'Toggle dark mode');
    themeToggle.innerHTML = '<span class="theme-icon">' + (currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô') + '</span>';
    mastheadMenu.appendChild(themeToggle);
    
    themeToggle.addEventListener('click', function() {
      const theme = document.documentElement.getAttribute('data-theme');
      const newTheme = theme === 'light' ? 'dark' : 'light';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      document.body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      
      const themeIcon = themeToggle.querySelector('.theme-icon');
      themeIcon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    });
  }
})();
</script>